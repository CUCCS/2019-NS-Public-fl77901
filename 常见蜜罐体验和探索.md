# 常见蜜罐体验和探索

---
## 实验目的
- 了解蜜罐的分类和基本原理
- 了解不同类型蜜罐的适用场合
- 掌握常见蜜罐的搭建和使用
## 实验环境
- 从[paralax/awesome-honeypots ][1]中选择 1 种低交互蜜罐和 1 种中等交互蜜罐进行搭建实验
    - 推荐 `SSH` 蜜罐
- 实验使用的两台虚拟机均使用NAT网络，其IP地址显示如下：
    ![拓扑结构][2]    
## 实验要求
- 记录蜜罐的详细搭建过程；
- 使用 `nmap` 扫描搭建好的蜜罐并分析扫描结果，同时分析「 `nmap` 扫描期间」蜜罐上记录得到的信息；
- 如何辨别当前目标是一个「蜜罐」？以自己搭建的蜜罐为例进行说明；
- （可选）总结常见的蜜罐识别和检测方法；
- （可选）基于[canarytokens][3]搭建蜜信实验环境进行自由探索型实验；
## 实验过程
### ssh-Honeypot
- 蜜罐搭建：
    - `git clone`文件ssh-honeypot到victim主机上；
    - `cd`进入ssh-honeypot文件夹，使用`vi`命令修改默认端口号22为56（使用不常用端口号，让出22端口位置）；
    - `service ssh restart`(启动ssh服务)；
    - 安装docker-compose，启动docker服务；
    - 在ssh-honeypot文件夹下使用`apt`命令安装ssh搭建所需软件包；
    - 剩下三条口令如图所示，密码部分不填，直接enter；
    ![搭建01][4]
    ![改端口号][5]
    ![搭建02][6]
    ![搭建03][7]
- 使用`nmap`扫描搭建好的蜜罐并分析扫描结果
    - 攻击者attacker主机尝试和victim主机进行ssh连接；
    - 尝试两次输入密码，每次都显示`Permission denied,please try again`；
    - 观察victim主机日志记录，发现其清晰地记录了被攻击的时间、攻击者的IP以及输入的的密码，达到了蜜罐搜集对方信息的目标；
    - 在attacker主机上不填密码直接enter，对应的victim主机显示没有密码；
    - 最后，在attacker主机上对victim主机进行`nmap`端口扫描，发现victim主机ssh日志上没有发生任何变化，说明该蜜罐对扫描并未关注；
    ![honeypot访问][8]
    ![nmap端口扫描][9]
- ssh-Honeypot总结：
    - ssh-Honeypot是一个低交互蜜罐，仅能简单记录ssh连接请求数据，对`nmap`端口扫描无法捕获。
### cowrie
- 蜜罐搭建：
    - `git clone`文件cowrie到victim主机上；
    - `cd`进入cowrie文件目录下；
    - `service docker start`开启docker服务；
    - `docker pull cowrie/cowrie`下载镜像文件；
    - `docker run -p 2222:2222 cowrie/cowrie`启动cowrie，在2222端口开启；
    ![co搭建01][10]
    ![co搭建02][11]
- 使用`nmap`扫描搭建好的蜜罐并分析扫描结果
    - 在attacker主机上使用`ssh root@10.0.2.7 -p 2222`连接victim主机，密码可随便输入（这里存在被攻击风险）；
    - attacker主机连接上后`ping www.baidu.com`，在victim主机日志下可以看到其输入命令；
    - attacker主机输入`curl www.baidu.com`后，可以看到出现`NoneType object has no attribute strip`报错，这是一个python类型的报错，可以看出这是一个python类型的蜜罐。
    - 这时，连接突然断开，推测蜜罐有设置连接时间的限制；
    - 蜜罐断开后，在attacker主机上对victim主机进行`nmap`扫描，发现victim主机日志文件没有发生任何变化，说明attacker的扫描没有被记录。
    ![co连接01][12]
    ![co连接02][13]
    ![co连接03][14]
- cowrie总结:
    - cowrie是一个中等交互蜜罐，提供的命令、错误提示等比较全面，可以进行ssh远程连接等类似真机的操作，`nmap`扫描攻击不会被记录，这个蜜罐是个 python 蜜罐。
## 实验总结
- 实验中遇到的问题及解决：
    - 在进行ssh-Honeypot蜜罐搭建时，发现一直显示`FATAL:ssh_bind_listen()`；解决：经过排查以及重复试验发现出现这一现象的原因是ssh安装辅助软件包下错了位置，应该在ssh-honeypot文件目录下下载，恢复虚拟机快照，重新进行实验，成功。
    - 注意在使用`nmap`命令进行蜜罐扫描时要退出蜜罐连接状态。
- 如何辨别当前的目标是蜜罐？
    - ssh—Honeypot实验中，无论密码是否正确都不能连接，可看出不是真机而是蜜罐；
    - cowrie实验中，连接一段时间后自动断开、出现python类型报错等都说明是蜜罐而非真机；
## 实验参考资料：
- https://github.com/CUCCS/2019-NS-Public-DXY0411/blob/ns_chap0x11/ns_chap0x11/%E5%B8%B8%E8%A7%81%E8%9C%9C%E7%BD%90%E4%BD%93%E9%AA%8C%E5%92%8C%E6%8E%A2%E7%B4%A2.md（一位同学的实验报告）；
- https://github.com/droberson/ssh-honeypot（ssh-Honeypot下载）；
- https://github.com/cowrie/cowrie（cowrie下载）；


  [1]: https://github.com/paralax/awesome-honeypots
  [2]: https://s2.ax1x.com/2019/12/17/QolNJH.jpg
  [3]: https://github.com/thinkst/canarytokens
  [4]: https://s2.ax1x.com/2019/12/17/QolJoD.jpg
  [5]: https://s2.ax1x.com/2019/12/17/QoltFe.jpg
  [6]: https://s2.ax1x.com/2019/12/17/Qol1L6.jpg
  [7]: https://s2.ax1x.com/2019/12/17/QotWUP.jpg
  [8]: https://s2.ax1x.com/2019/12/17/QolGdO.jpg
  [9]: https://s2.ax1x.com/2019/12/17/Qol8eK.jpg
  [10]: https://s2.ax1x.com/2019/12/20/QLzaMF.jpg
  [11]: https://s2.ax1x.com/2019/12/20/QLzNxU.jpg
  [12]: https://s2.ax1x.com/2019/12/20/QLzwqJ.jpg
  [13]: https://s2.ax1x.com/2019/12/20/QLzdr4.jpg
  [14]: https://s2.ax1x.com/2019/12/20/QLzt2T.jpg